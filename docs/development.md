# Development

## Installation

1. Install [Node.js](https://nodejs.org/)
2. Install and run [Redis](https://redis.io/download)
3. `git clone https://github.com/guyfawcus/beer-fest.git`
4. `cd beer-fest`
5. `npm install`
6. `node server.js`
7. Open [127.0.0.1:8000](http://127.0.0.1:8000/) in an up-to-date browser

### Environment variables

- `ADMIN_CODE`- A bcrypt hashed password (take a look at [/utils/codegen.js](/utils/codegen.js))
- `COOKIE_SECRET` - A cryptographically secure random string (take a look at [/utils/codegen.js](/utils/codegen.js))
- `ENABLE_API` - `true` or `false` depending on whether you want to enable the API POST endpoints or not (can be left unset, defaults to `false`)
- `NODE_ENV` - set to `production` if deployed (can be left unset when developing)
- `REDIS_URL`- the `redis://` URL (can be left unset if using Redis with it's default settings)

## Coding

After you have installed the app with `npm install` you can get coding!
Installation will give you the following to help in working with this software:

- [DefinitelyTyped](https://github.com/DefinitelyTyped/DefinitelyTyped#readme) - For type checking and usage notes in your IDE
- [nodemon](https://nodemon.io/) - Restarts the server when you make a change to the code
- [Husky](https://github.com/typicode/husky#readme) - For running tests before committing and pushing with Git
- [Prettier](https://prettier.io/) - Code formatter to keep the style consistent
- [Standard JS](https://standardjs.com/) - Rules for linting the code with...
- [ESLint](https://eslint.org/) - Static analysis tool to for catching problems before they appear
- [JSDoc](https://jsdoc.app/) - For generating documentation

### Setup

By default, if the if the `ADMIN_CODE` environment variable is not set,
the server will generate a random one on startup.
This will mean that you won't have any idea what the login code is.

Also, if the `COOKIE_SECRET` environment variable is not set,
the server will generate a new one on startup.
This will have the effect of logging you out after every restart.

For these reasons it is recommended to run `node utils/codegen.js` and follow the instructions on how to set these two variables before you run the server.

This project has been written using Visual Studio Code.
It's not essential that you do as well,
but if you would like to make the most of the type annotations and pre-commit formatting,
install the [Prettier extension](https://github.com/prettier/prettier-vscode)
then add the following lines to your [settings.json](https://code.visualstudio.com/docs/getstarted/settings):

```
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "javascript.implicitProjectConfig.checkJs": true,
```

### Dev workflow

1. Swap to a new branch with `git checkout -b`
2. Run `nodemon server.js`
3. Make some changes
4. Run `npm run test`
5. Ensure your changes have had the desired effect
6. Commit your code with a message about what has changed (`git commit -a`)
7. Create a [pull request](https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/about-pull-requests)
8. Have a beer!

### Security

A number of security measures have been implemented in the server
and throughout the codebase to try and prevent any nefarious activity from taking place,
or at least slow someone down until all of the beer is gone!

These are unlikely to get in the way of development,
but if you keep running into errors that you don't understand (likely Content Security Policy related ones),
then just comment out the security section in the server,
hack away, open a pull request then discuss the issue.
Please DO NOT deploy this application in an insecure state.

The other place you may run into problems is with the static type checker (ESLint).
These checks are there to help prevent bugs and to ensure a consistent style.
All of these checks must pass before a commit to the master branch,
but f you're just hacking away and want to try something out,
do it in a new branch then commit with `git commit --no-verify`,
then like with a security problem,
just open a pull request or an issue and someone will help you out.

## Documentation

The documentation for this project can be generated by running `npm run docs`. JSdoc is used to parse the comments and type annotations throughout the codebase. The output files are located in the `docs/jsdoc/` folder and can be viewed by opening up the homepage with `firefox docs/jsdoc/index.html`.
